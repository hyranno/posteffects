ポストエフェクト集
TypeScript + SolidJS + WebGL


ソフトウェアとしての方向性を詰める
  動画にリアルタイムで適用したい
    ontimeupdateから描画処理を呼ぶ
      負荷がかからない程度の頻度でしか更新してくれない
    MediaStreamのaddtrackイベントは違うっぽい
      HTMLMediaElement.captureStream に linter が対応してないのもある?
    setIntervalで描画を呼んでいいか
  エフェクトをGUIで動的にスタックしたい
    シェーダグラフ作れれば一番良いけど労力が厳しいしユーザのハードルも上がりそう
    スタック末尾にエフェクト追加ボタン
    スタック内の各エフェクトをアコーディオンにしておく(setVisibleとShowを持つ)
      パラメータ調節(signal経由)
      削除
  ユーザのローカルから動画をストリーミング入力できたりしないか？
    OBSの仮想カメラなら普通にいけそう
    navigator.mediaDevices.getUserMedia()
      <HTMLMediaElement>.srcObject=stream
    https://developer.mozilla.org/ja/docs/Web/Guide/Audio_and_video_delivery

clampの引数順の修正
filter1d, blur は ...vec3 で代用できるので消したい
StackedEffectはbloomとかにも使えそう


Effects
  nop
  色収差
  tone curve,
  減色
    ハーフトーン
    ディザ減色
  Blur
    filter1d(filter1d(src))
  Bloom
    add(src, add(filter1d(filter1d(knee(src))), -(kernel_center^2)*knee(src)))
    knee curve https://light11.hatenadiary.com/entry/2018/02/15/011155
  Glare
    add(src, rotated_filter1d(knee(src)), rotated_filter1d(knee(src)), ...)
  Halo
    add(src, large_bloom(src), -small_bloom(src))
  モーションブラー
  光の軌跡
    knee + motion blur
  radial filter
    外へ行くほどkernelを大きくしたい
  radial blur
    radial filter
  radial edge
    radial filter (正規分布の微分)
  tone curve
    RGB, HSV
  //
  radial color grading
    hsl
      S字トーンカーブの急峻さをrで変更
    rainbow
      色相S字トーンカーブの原点をrで移動
  radial warp
  radial系の、angleによるノイズ
    (0..N).map(|n| (n*angle).sin()).sum()
  グリッチ
    https://github.com/syuilo/glitch-studio
    トーンカーブ
    色調遷移
    translate
    adaptive threshold
    モザイク
    歪み
  wavelet変換
  不可逆圧縮, 解凍
    wavelet変換後、対数で量子化
    色空間の変換や、符号化方式も検討する
    zlibで圧縮 https://github.com/imaya/zlib.js
    jpeg, webp などと同じサイズで比較
     base64は6ビットなので元々の4/3倍
    動画に適用して強みを活かすべきか
      元画像に収束する
      計算量が小さい(リソース、レイテンシでの有利)
  水の表現
    角度が小さい -> 透明度が低い, 波が小さい
    角度が大きい -> 透明度が高い, 波が大きい
